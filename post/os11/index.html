<!DOCTYPE html>
<html><head>
<title>操作系统笔记 CH11 File-System Implementation</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="操作系统笔记 CH11 File-System Implementation" />
<meta property="og:description" content="文件系统结构 磁盘特点：可以原地重写，可以直接访问任意一块。
内存和磁盘之间的IO以块为单位。每块为一个或多个扇区。扇区通常为512B
File system resides on secondary storage (disks) OS通过文件系统存储、定位、提取数据
IO control 最底层
由device driver 和 Interrupt handlers组成
实现内存和磁盘之间的信息传输。
device driver可作为翻译器。输入是高层命令，输出是底层的、硬件特定的命令。命令用于控制hardware controller
device driver控制一类设备
basic file system
Issue generic commands to the appropriate device driver to read and write physical blocks on the disk.
file-organization module
将逻辑块地址 转换成 物理块地址
也包括空闲空间管理器
logical file system
管理metadata，元数据包括文件系统所有结构数据，而不包括实际数据
管理目录结构
通过FCB((inodes in UNIX))维护文件结构
负责保护和安全
Layering useful for reducing complexity and redundancy, but adds overhead and can decrease performance." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://imfaye.me/post/os11/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-02-28T13:11:24+00:00" />
<meta property="article:modified_time" content="2020-02-28T13:11:24+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="操作系统笔记 CH11 File-System Implementation"/>
<meta name="twitter:description" content="文件系统结构 磁盘特点：可以原地重写，可以直接访问任意一块。
内存和磁盘之间的IO以块为单位。每块为一个或多个扇区。扇区通常为512B
File system resides on secondary storage (disks) OS通过文件系统存储、定位、提取数据
IO control 最底层
由device driver 和 Interrupt handlers组成
实现内存和磁盘之间的信息传输。
device driver可作为翻译器。输入是高层命令，输出是底层的、硬件特定的命令。命令用于控制hardware controller
device driver控制一类设备
basic file system
Issue generic commands to the appropriate device driver to read and write physical blocks on the disk.
file-organization module
将逻辑块地址 转换成 物理块地址
也包括空闲空间管理器
logical file system
管理metadata，元数据包括文件系统所有结构数据，而不包括实际数据
管理目录结构
通过FCB((inodes in UNIX))维护文件结构
负责保护和安全
Layering useful for reducing complexity and redundancy, but adds overhead and can decrease performance."/>










  




<link rel="icon" href="https://imfaye.me/img/wind.png">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<link rel="stylesheet" href="/scss/journal.min.d4c42cc03dd5885ad6a856f72cdc8991e948d78f13915e5ad7a9ea75041f0501.css" integrity="sha256-1MQswD3ViFrWqFb3LNyJkelI148TkV5a16nqdQQfBQE=" media="screen">



<link rel="stylesheet" href="/scss/dark-mode.min.b063970adbc0451db461a3b3a99c3ac07ae784200123238e4bc8fc340e6b69ce.css" integrity="sha256-sGOXCtvARR20YaOzqZw6wHrnhCABIyOOS8j8NA5rac4=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>
















</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://imfaye.me/">
    
        <div class="nav-title">
            著花未
        </div>
        
        <div class="nav-subtitle">
            陈列一些废话和一些想记下的
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts">
                归档
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                分类
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                标签
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                关于
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Faye
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%bb%93%e6%9e%84" onclick="onNavClick(`#文件系统结构-nav`)" id="文件系统结构-nav">
									文件系统结构
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%ae%9e%e7%8e%b0" onclick="onNavClick(`#文件系统实现-nav`)" id="文件系统实现-nav">
									文件系统实现
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#in-memory-file-system-structures" onclick="onNavClick(`#in-memory-file-system-structures-nav`)" id="in-memory-file-system-structures-nav">
									In-Memory File System Structures
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#partitions-and-mounting-%e5%88%86%e5%8c%ba%e5%92%8c%e5%ae%89%e8%a3%85" onclick="onNavClick(`#partitions-and-mounting-分区和安装-nav`)" id="partitions-and-mounting-分区和安装-nav">
									partitions and mounting 分区和安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#virtual-file-system-vfs" onclick="onNavClick(`#virtual-file-system-vfs-nav`)" id="virtual-file-system-vfs-nav">
									virtual file system (VFS)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%9b%ae%e5%bd%95%e5%ae%9e%e7%8e%b0" onclick="onNavClick(`#目录实现-nav`)" id="目录实现-nav">
									目录实现
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#linear-list-%e7%ba%bf%e6%80%a7%e5%88%97%e8%a1%a8" onclick="onNavClick(`#linear-list-线性列表-nav`)" id="linear-list-线性列表-nav">
									linear list 线性列表
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#hash-table" onclick="onNavClick(`#hash-table-nav`)" id="hash-table-nav">
									hash table
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e9%85%8d%e6%96%b9%e6%b3%95" onclick="onNavClick(`#分配方法-nav`)" id="分配方法-nav">
									分配方法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#contiguous-allocation-%e8%bf%9e%e7%bb%ad%e5%88%86%e9%85%8d" onclick="onNavClick(`#contiguous-allocation-连续分配-nav`)" id="contiguous-allocation-连续分配-nav">
									Contiguous Allocation 连续分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#linked-allocation-%e9%93%be%e6%8e%a5%e5%88%86%e9%85%8d" onclick="onNavClick(`#linked-allocation-链接分配-nav`)" id="linked-allocation-链接分配-nav">
									Linked Allocation 链接分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#fatfile-allocation-table%e6%96%87%e4%bb%b6%e5%88%86%e9%85%8d%e8%a1%a8" onclick="onNavClick(`#fatfile-allocation-table文件分配表-nav`)" id="fatfile-allocation-table文件分配表-nav">
									FAT(file-allocation table)文件分配表
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#indexed-allocation-%e7%b4%a2%e5%bc%95%e5%88%86%e9%85%8d" onclick="onNavClick(`#indexed-allocation-索引分配-nav`)" id="indexed-allocation-索引分配-nav">
									Indexed Allocation 索引分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%a7%e8%83%bd" onclick="onNavClick(`#性能-nav`)" id="性能-nav">
									性能
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#free-space-management" onclick="onNavClick(`#free-space-management-nav`)" id="free-space-management-nav">
									free-space management
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bit-map--bit-vector" onclick="onNavClick(`#bit-map--bit-vector-nav`)" id="bit-map--bit-vector-nav">
									bit map / bit vector
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#linked-list-%e9%93%be%e8%a1%a8" onclick="onNavClick(`#linked-list-链表-nav`)" id="linked-list-链表-nav">
									linked list 链表
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#grouping" onclick="onNavClick(`#grouping-nav`)" id="grouping-nav">
									grouping
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#counting" onclick="onNavClick(`#counting-nav`)" id="counting-nav">
									counting
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts">
                    归档
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    分类
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    标签
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    关于
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%bb%93%e6%9e%84" onclick="onNavClick(`#文件系统结构-nav`)" id="文件系统结构-nav">
									文件系统结构
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%ae%9e%e7%8e%b0" onclick="onNavClick(`#文件系统实现-nav`)" id="文件系统实现-nav">
									文件系统实现
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#in-memory-file-system-structures" onclick="onNavClick(`#in-memory-file-system-structures-nav`)" id="in-memory-file-system-structures-nav">
									In-Memory File System Structures
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#partitions-and-mounting-%e5%88%86%e5%8c%ba%e5%92%8c%e5%ae%89%e8%a3%85" onclick="onNavClick(`#partitions-and-mounting-分区和安装-nav`)" id="partitions-and-mounting-分区和安装-nav">
									partitions and mounting 分区和安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#virtual-file-system-vfs" onclick="onNavClick(`#virtual-file-system-vfs-nav`)" id="virtual-file-system-vfs-nav">
									virtual file system (VFS)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%9b%ae%e5%bd%95%e5%ae%9e%e7%8e%b0" onclick="onNavClick(`#目录实现-nav`)" id="目录实现-nav">
									目录实现
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#linear-list-%e7%ba%bf%e6%80%a7%e5%88%97%e8%a1%a8" onclick="onNavClick(`#linear-list-线性列表-nav`)" id="linear-list-线性列表-nav">
									linear list 线性列表
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#hash-table" onclick="onNavClick(`#hash-table-nav`)" id="hash-table-nav">
									hash table
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e9%85%8d%e6%96%b9%e6%b3%95" onclick="onNavClick(`#分配方法-nav`)" id="分配方法-nav">
									分配方法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#contiguous-allocation-%e8%bf%9e%e7%bb%ad%e5%88%86%e9%85%8d" onclick="onNavClick(`#contiguous-allocation-连续分配-nav`)" id="contiguous-allocation-连续分配-nav">
									Contiguous Allocation 连续分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#linked-allocation-%e9%93%be%e6%8e%a5%e5%88%86%e9%85%8d" onclick="onNavClick(`#linked-allocation-链接分配-nav`)" id="linked-allocation-链接分配-nav">
									Linked Allocation 链接分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#fatfile-allocation-table%e6%96%87%e4%bb%b6%e5%88%86%e9%85%8d%e8%a1%a8" onclick="onNavClick(`#fatfile-allocation-table文件分配表-nav`)" id="fatfile-allocation-table文件分配表-nav">
									FAT(file-allocation table)文件分配表
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#indexed-allocation-%e7%b4%a2%e5%bc%95%e5%88%86%e9%85%8d" onclick="onNavClick(`#indexed-allocation-索引分配-nav`)" id="indexed-allocation-索引分配-nav">
									Indexed Allocation 索引分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%a7%e8%83%bd" onclick="onNavClick(`#性能-nav`)" id="性能-nav">
									性能
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#free-space-management" onclick="onNavClick(`#free-space-management-nav`)" id="free-space-management-nav">
									free-space management
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bit-map--bit-vector" onclick="onNavClick(`#bit-map--bit-vector-nav`)" id="bit-map--bit-vector-nav">
									bit map / bit vector
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#linked-list-%e9%93%be%e8%a1%a8" onclick="onNavClick(`#linked-list-链表-nav`)" id="linked-list-链表-nav">
									linked list 链表
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#grouping" onclick="onNavClick(`#grouping-nav`)" id="grouping-nav">
									grouping
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#counting" onclick="onNavClick(`#counting-nav`)" id="counting-nav">
									counting
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://imfaye.me/">
            著花未
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://imfaye.me/">
        <div class="single-column-header-title">著花未</div>
        
        <div class="single-column-header-subtitle">陈列一些废话和一些想记下的</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    操作系统笔记 CH11 File-System Implementation
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2020-02-28 13:11
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[无情笔记]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>
                                &nbsp;
                            
                                <a href="/tags/%E5%A4%A7%E6%98%8E%E6%B9%96%E7%95%94%E7%9A%84%E4%B8%93%E4%B8%9A%E8%AF%BE">大明湖畔的专业课</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="文件系统结构">文件系统结构</h2>
<p>磁盘特点：可以原地重写，可以直接访问任意一块。</p>
<p>内存和磁盘之间的IO以块为单位。每块为一个或多个扇区。扇区通常为512B</p>
<p>File system resides on secondary storage (disks) OS通过文件系统存储、定位、提取数据</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577502786991.png" alt=""></p>
<ul>
<li>
<p>IO control 最底层</p>
<p>由device driver 和 Interrupt handlers组成</p>
<p>实现内存和磁盘之间的信息传输。</p>
<p>device driver可作为翻译器。输入是高层命令，输出是底层的、硬件特定的命令。命令用于控制hardware controller</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577503036078.png" alt=""></p>
<p>device driver控制一类设备</p>
</li>
<li>
<p>basic file system</p>
<p>Issue generic commands to the appropriate device driver to read and write physical blocks on the disk.</p>
</li>
<li>
<p>file-organization module</p>
<p>将逻辑块地址 转换成 物理块地址</p>
<p>也包括空闲空间管理器</p>
</li>
<li>
<p>logical file system</p>
<p>管理metadata，元数据包括文件系统所有结构数据，而不包括实际数据</p>
<p>管理目录结构</p>
<p>通过FCB((inodes in UNIX))维护文件结构</p>
<p>负责保护和安全</p>
</li>
</ul>
<p>Layering useful for reducing complexity and redundancy, but adds overhead and can decrease performance.</p>
<p>绝大多数OS支持多个文件系统</p>
<p>UNIX使用UFS</p>
<p>标准的Linux文件系统是extende file system</p>
<h2 id="文件系统实现">文件系统实现</h2>
<p>每个卷的boot control block：从该卷引导OS需要的信息。如果没有OS，该块为空，通常为卷的第一块。UFS称之为boot block，NTFS称之为partition boot sector</p>
<p>每个卷的volume control blcok：包括卷(或分区)的详细信息，如分区的块数，块的大小&hellip;UFS称之为superblock，NTFS中它存在master file table中</p>
<p>每个文件系统的目录结构用来组织文件。UFS中包含文件名和相关的inode号，NTFS中它存储在master file table中</p>
<p>每个文件的FCB。UFS中是inode，NTFS存在master file table中，每个文件占一行</p>
<h3 id="in-memory-file-system-structures">In-Memory File System Structures</h3>
<p>一个内存中的mount table(partition table)</p>
<p>一个内存中的director structure cache</p>
<p>system-wide open-file table: 包括每个打开文件的FCB副本</p>
<p>per-process open-file table: Contains a pointer to the appropriate entry in the system-wide open-file table.</p>
<p>buffers hold data blocks from secondary storage.</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577507477227.png" alt=""></p>
<p>对于访问打开文件表的索引：UNIX称之为file descriptor，Windows称之为file handle. 只要文件没有关闭，所有文件操作都是通过打开文件表来进行的</p>
<h3 id="partitions-and-mounting-分区和安装">partitions and mounting 分区和安装</h3>
<p>一个disk可以分为多个partition，一个partition可以横跨多个disk(作为RAID的一种形式比较合适)</p>
<p>分区可以是</p>
<ul>
<li>raw 没有文件系统</li>
<li>cooked 含有文件系统</li>
</ul>
<p>引导信息能保存在多个分区中，通常为一组有序块，并作为镜像文件读入内存</p>
<p>boot loader知道位于引导区的多个文件系统和多个操作系统，一旦装入，它可以引导位于磁盘上的一个操作系统。磁盘可以有多个分区，每个分区包含不同类型的文件系统和不同的操作系统。</p>
<p>root partiton包括操作系统内核或其他系统文件，在引导时装入内存。</p>
<p>内存中有Mount table – containing information about file systems that has been mounted.</p>
<h3 id="virtual-file-system-vfs">virtual file system (VFS)</h3>
<p>Virtual file system (VFS) on most OSes, including Unix, use object-oriented techniques to implement the file system. 用户甚至可以访问位于网络上的操作系统</p>
<p>VFS allows the same system call interface (the API) to be used for different types of file systems.</p>
<p>Implements vnodes which hold inodes or network file details.</p>
<p>The API is to the VFS interface, rather than any specific type of file system.</p>
<p>多个VFS接口的实现可以共存在同一台机器上</p>
<p>vnode表示位于整个网络范围内唯一的文件</p>
<p>Linux has four object types: inode, file, superblock, dentry</p>
<p>VFS defines a set of operations on the objects that must be implemented.</p>
<h2 id="目录实现">目录实现</h2>
<h3 id="linear-list-线性列表">linear list 线性列表</h3>
<p>linear search time费时</p>
<p>sorted list允许binary search</p>
<p>a balanced tree</p>
<h3 id="hash-table">hash table</h3>
<p>decreases directory search time</p>
<p>需要处理collision(两个文件名哈希到相同的位置)：chained-overflow</p>
<p>Difficulties: fixed size, hash function</p>
<h2 id="分配方法">分配方法</h2>
<p>how disk blocks are allocated for files</p>
<h3 id="contiguous-allocation-连续分配">Contiguous Allocation 连续分配</h3>
<p>每个文件在磁盘上占有一组连续的块</p>
<p>访问连续分配文件所需寻道数最少</p>
<p>用第一块的磁盘地址和连续块的数量来定义</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577509061560.png" alt=""></p>
<p>sequential and direct access</p>
<p>Best performance in most cases</p>
<p>问题</p>
<ul>
<li>Difficult to find space for a new file: First-fit, best-fit</li>
<li>External fragmentation</li>
<li>compaction off-line (downtime) or on-line</li>
</ul>
<p>Extent-Based Systems, a modified contiguous allocation scheme 当空间不够时，另一块被称为扩展的连续空间会添加到原来的文件分配中</p>
<h3 id="linked-allocation-链接分配">Linked Allocation 链接分配</h3>
<p>每个文件是磁盘块的链表</p>
<p>目录包括文件第一块的指针和最后一块的指针。每一块都有下一块的指针。</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577509383605.png" alt=""></p>
<p>没有外部碎片</p>
<p>只要有空闲块，文件就可以增大</p>
<p>Disadvantages: 不能随机访问，指针需要空间，不可靠</p>
<p>对于指针需要空间，解决办法是将多个块组成簇(cluster)，代价是增加了内部碎片</p>
<h4 id="fatfile-allocation-table文件分配表">FAT(file-allocation table)文件分配表</h4>
<p>used by MS-DOS and OS/2</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577510977781.png" alt=""></p>
<p>对FAT采用缓存</p>
<p>支持直接访问</p>
<h3 id="indexed-allocation-索引分配">Indexed Allocation 索引分配</h3>
<p>每个文件都有索引块，是一个磁盘块地址的数组</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577511076567.png" alt=""></p>
<p>目录条目包括索引块的地址</p>
<p>支持直接访问</p>
<p>没有外部碎片</p>
<p>索引块应该多大</p>
<ul>
<li>
<p>linked scheme</p>
<p>将多个索引块链接起来</p>
</li>
<li>
<p>two-level index</p>
</li>
<li>
<p>combined scheme</p>
<p>UNIX采用</p>
</li>
</ul>
<h3 id="性能">性能</h3>
<p>contiguous great for sequential and random</p>
<p>linked good for sequential, not random</p>
<p>combine contiguous allocation with indexed allocation by using contiguous allocation for small files (up to three or four blocks), automatically switching to an indexed allocation if the file grows large.</p>
<h3 id="free-space-management">free-space management</h3>
<p>文件系统需要维护free-space list记录空闲磁盘空间(不一定是链表)</p>
<h4 id="bit-map--bit-vector">bit map / bit vector</h4>
<p>每块用一位表示。空闲-1，已分配-0</p>
<p>查找第一个和n个连续空闲块简单高效</p>
<p>Bit map requires extra space.</p>
<p>Easy to get contiguous files space.</p>
<h4 id="linked-list-链表">linked list 链表</h4>
<p>将所有空闲块用链表链接</p>
<p>将指向第一空闲块的指针缓存在内存</p>
<p>Cannot get contiguous space easily.</p>
<h4 id="grouping">grouping</h4>
<p>将n个空闲块的地址存在第一个空闲块里。(前n-1确实为空，最后一块包含另外n个空闲块的地址)</p>
<p>可以找到大量空闲块</p>
<p><img src="https://raw.githubusercontent.com/bygonexf/Blog-Images/master/1577512314875.png" alt=""></p>
<h4 id="counting">counting</h4>
<p>记录第一块的地址和紧跟第一块的连续的空闲块的数量n</p>
<p>can be stored in a balanced tree for efficiency</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2020-02-28</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/post/os12/">
			下回<br>操作系统笔记 CH12 Mass-Storage Structure
                </a>
                
                
                
                <a class="older-posts" href="/post/os10/">
			上回<br>操作系统笔记 CH10 File-System Interface
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Faye
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
